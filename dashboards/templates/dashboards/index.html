<html>

<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>

<body>
	<fieldset>
		<legend>
			Create a query
		</legend>
		<form method="get">
			<p>
				<label for="#test_suit">Test suit</label>
				<input type="text" id="test_suit" value="content_unittests">
			</p>
			<p>
				<label for="">Tasks limit</label>
				<input type="text" id="tasks_limit" value="1">
			</p>
			<p>
			<p>
				<div id="os_checboxes">
	<!--				 Django template - generate list of checkboxes-->
					{% for key, dict_args in oss.items %}
						<input type="checkbox" id="chb_{{ dict_args.name }}" name="{{dict_args.name}}" {{ dict_args.checked }} {{ dict_args.disabled }}> {{ dict_args.innerHtml }} <br>	
					{% endfor %}
				</div>
			
			<p>
				<button id="btn_submit" name="submit"> Submit </button>
			</p>
		</form>
	 
	</fieldset>



	<script>
		$(document).ready(function () {
			$("#btn_submit").click(function (e) {
				
//			 	getting selected oss
				var selected_chb = [];
				$('#os_checboxes input:checked').each(function() {
					selected_chb.push($(this).attr('name'));
				})
				
				alert('Sending a request!');
//				get array of checked os and submit this array to server
				e.preventDefault();
				$.ajax({
					url: window.location.href + "get_data/",
					dataType: "json",
					data: {
						test_suit: $("#test_suit").val(),
						tasks_limit: $("#tasks_limit").val(),
						oss: JSON.stringify(selected_chb),
					},
					success: function (result) {
						alert('server responded');
						prompDrawingChart(result['buckets']);
					},
					error: function (result) {
						alert('error')
					}
				})
			})
		});
	</script>

	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		function prompDrawingChart(frequency_on_intervals) {
			console.log(frequency_on_intervals);
			var arr_frequency_on_intervals = [['runtime ms', 'number of tests']];
			for (var interval in frequency_on_intervals) {
				var arr_item = [];
				arr_item.push(interval, frequency_on_intervals[interval]);
				arr_frequency_on_intervals.push(arr_item);
			}
			console.log(arr_frequency_on_intervals);
			google.charts.load("current", {
				packages: ["corechart"]
			});
			google.charts.setOnLoadCallback(drawChart);

			function drawChart() {
				var data = google.visualization.arrayToDataTable(
					arr_frequency_on_intervals
				);

				var options = {
					title: 'Runtime of tests',
					legend: {
						position: 'none'
					},
				};

				var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
				chart.draw(data, options);
			}
		}
	</script>

	<div id="chart_div" style="width: 1100px; height: 700px;"></div>

</body>

</html>